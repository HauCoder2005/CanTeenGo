<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Orders | CanTinGo</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
* { font-family: 'Poppins', sans-serif; }
body { background: #f4f6f9; margin: 0; }
.sidebar { position: fixed; top: 0; left: 0; width: 260px; height: 100vh; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; box-shadow: 5px 0 15px rgba(0,0,0,0.1); z-index: 999; }
.sidebar-header { text-align: center; padding: 20px 0; }
.sidebar-header h3 { margin-top: 10px; font-weight: 600; }
.sidebar-menu { margin-top: 30px; }
.sidebar-menu a { display: flex; align-items: center; padding: 14px 20px; color: rgba(255,255,255,0.8); text-decoration: none; border-radius: 12px; margin: 8px 0; transition: 0.3s; }
.sidebar-menu a i { margin-right: 12px; font-size: 18px; }
.sidebar-menu a:hover, .sidebar-menu a.active { background: rgba(255,255,255,0.2); color: white; transform: translateX(5px); }
.main-content { margin-left: 260px; padding: 30px; }
.topbar { background: white; padding: 15px 25px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; }
.topbar h1 { font-size: 24px; color: #333; margin: 0; }
.user-info { display: flex; align-items: center; gap: 10px; }
.user-info img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
.user-info span { font-weight: 600; color: #555; }
.table-container { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow-x: auto; }
table { width: 100%; border-collapse: collapse; text-align: center; }
th, td { padding: 12px; border-bottom: 1px solid #eee; }
th { background-color: #f4f4f4; }
.status-pending { color: orange; font-weight: bold; }
.status-completed { color: green; font-weight: bold; }
.status-cancelled { color: red; font-weight: bold; }
.btn-pay { padding: 4px 8px; font-size: 12px; margin-left: 5px; }
</style>
</head>
<body>
<div class="sidebar">
    <div class="sidebar-header"><h3>CanTinGo</h3></div>
    <div class="sidebar-menu">
        <a th:href="@{/admin/}"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        <a th:href="@{/admin/users}"><i class="fas fa-users"></i><span>Người dùng</span></a>
			<a class="active" th:href="@{/order/admin/data}"><i class="fas fa-shopping-cart"></i><span>Đơn hàng</span></a>

        <a class="d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuFood">
            <span><i class="fas fa-utensils"></i> Thực đơn</span> <i class="fas fa-chevron-down"></i>
        </a>
        <div class="collapse" id="menuFood">
            <a th:href="@{/food-category}" class="ms-4 d-block py-1 text-white text-decoration-none">Quản lý nhóm món ăn</a>
            <a th:href="@{/food-menu}" class="ms-4 d-block py-1 text-white text-decoration-none">Quản lý món ăn</a>
            <a th:href="@{/combo}" class="ms-4 d-block py-1 text-white text-decoration-none">Combo</a>
        </div>

        <a href="#"><i class="fas fa-chart-bar"></i><span>Báo cáo</span></a>
        <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i><span>Đăng xuất</span></a>
    </div>
</div>
<div class="main-content">
	<div class="topbar">
		<h1>Quản lý đơn hàng</h1>
		<div class="user-info">
			<img src="/images/admin.jpg" alt="Admin" th:src="@{/images/admin.jpg}">
			<span>Admin</span>
		</div>
	</div>

	<div class="table-container">
		<table>
			<thead>
				<tr>
					<th>Mã đơn</th>
					<th>Khách hàng</th>
					<th>Tổng tiền</th>
					<th>Trạng thái</th>
					<th>Ngày đặt</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="order : ${orders}">
					<td th:text="${order.id}"></td>
					<td th:text="${order.users.first_name} + ' ' + ${order.users.last_name}"></td>
					<td th:text="${#numbers.formatDecimal(order.total_price,1,'COMMA',2,'POINT')} + ' VNĐ'"></td>
					<td>
						<form th:action="@{/order/admin/update-status}" method="post" style="display:flex; gap:5px; align-items:center;">
							<input type="hidden" name="orderId" th:value="${order.id}"/>
							<!-- Dropdown chọn trạng thái -->
							<select name="status" class="form-select form-select-sm" style="width:auto;">
								<option value="PENDING" th:selected="${order.status == 'PENDING'}">Pending</option>
								<option value="COMPLETED" th:selected="${order.status == 'COMPLETED'}">Completed</option>
								<option value="CANCELLED" th:selected="${order.status == 'CANCELLED'}">Cancelled</option>
							</select>
							<button type="submit" class="btn btn-sm btn-primary">Cập nhật</button>
							<!-- Nút thanh toán chỉ hiện khi PENDING -->
							<button type="submit" th:if="${order.status == 'PENDING'}" formaction="/order/pay-cash" class="btn btn-sm btn-success">Thanh toán</button>
						</form>
					</td>
					<td th:text="${order.orderDate}"></td>
				</tr>
				<tr th:if="${#lists.isEmpty(orders)}">
					<td colspan="5" style="color: gray;">Chưa có đơn hàng nào</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
